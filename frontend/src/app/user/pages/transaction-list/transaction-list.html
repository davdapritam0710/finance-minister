<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <mat-card class="daxa-card summary-card credit-card">
            <mat-card-content>
                <div class="d-flex align-items-center">
                    <div class="icon me-3">
                        <i class="material-symbols-outlined">trending_up</i>
                    </div>
                    <div>
                        <h6 class="mb-1 text-muted">Total Credit</h6>
                        <h4 class="mb-0 text-dark">{{ formatCurrency(summary.totalCredit, 'INR') }}</h4>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="col-md-3">
        <mat-card class="daxa-card summary-card debit-card">
            <mat-card-content>
                <div class="d-flex align-items-center">
                    <div class="icon me-3">
                        <i class="material-symbols-outlined">trending_down</i>
                    </div>
                    <div>
                        <h6 class="mb-1 text-muted">Total Debit</h6>
                        <h4 class="mb-0 text-dark">{{ formatCurrency(summary.totalDebit, 'INR') }}</h4>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="col-md-3">
        <mat-card class="daxa-card summary-card"
            [ngClass]="summary.netAmount >= 0 ? 'net-positive-card' : 'net-negative-card'">
            <mat-card-content>
                <div class="d-flex align-items-center">
                    <div class="icon me-3">
                        <i class="material-symbols-outlined">account_balance</i>
                    </div>
                    <div>
                        <h6 class="mb-1 text-muted">Net Amount</h6>
                        <h4 class="mb-0 text-dark">{{ formatCurrency(summary.netAmount, 'INR') }}</h4>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="col-md-3">
        <mat-card class="daxa-card summary-card count-card">
            <mat-card-content>
                <div class="d-flex align-items-center">
                    <div class="icon me-3">
                        <i class="material-symbols-outlined">receipt_long</i>
                    </div>
                    <div>
                        <h6 class="mb-1 text-muted">Total Transactions</h6>
                        <h4 class="mb-0 text-dark">{{ summary.transactionCount }}</h4>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>

<!-- Main Transaction List Card -->
<mat-card class="daxa-card transactions-list-card mb-25 border-radius bg-white border-none d-block">
    <mat-card-header>
        <mat-card-title>
            <h5 class="mt-0 mb-0">Transactions</h5>
        </mat-card-title>
        <mat-card-subtitle>
            <button type="button" mat-raised-button color="primary" (click)="openAddTransactionDialog()">
                <i class="material-symbols-outlined me-2">add</i>
                Add Transaction
            </button>
        </mat-card-subtitle>
    </mat-card-header>

    <!-- Filters -->
    <mat-card-content>
        <div class="filters-section mb-4">
            <div class="row g-3">
                <div class="col-md-2">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Type</mat-label>
                        <mat-select [(ngModel)]="filterForm.type">
                            <mat-option value="">All Types</mat-option>
                            <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
                                {{ type.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-md-2">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Category</mat-label>
                        <mat-select [(ngModel)]="filterForm.category">
                            <mat-option value="">All Categories</mat-option>
                            <mat-option *ngFor="let category of categories" [value]="category.value">
                                {{ category.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-md-2">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Start Date</mat-label>
                        <input matInput [matDatepicker]="startPicker" [(ngModel)]="filterForm.startDate">
                        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                        <mat-datepicker #startPicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-md-2">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>End Date</mat-label>
                        <input matInput [matDatepicker]="endPicker" [(ngModel)]="filterForm.endDate">
                        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                        <mat-datepicker #endPicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-md-3">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Search</mat-label>
                        <input matInput placeholder="Search transactions..." [(ngModel)]="filterForm.search">
                        <mat-icon matSuffix>search</mat-icon>
                    </mat-form-field>
                </div>
                <div class="col-md-1">
                    <button mat-raised-button color="primary" (click)="applyFilters()" class="w-100">
                        <i class="material-symbols-outlined">search</i>
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <button mat-button (click)="clearFilters()">
                        <i class="material-symbols-outlined me-2">clear</i>
                        Clear Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div *ngIf="loading" class="text-center py-4">
            <mat-spinner diameter="50"></mat-spinner>
            <p class="mt-2">Loading transactions...</p>
        </div>

        <!-- Transactions Table -->
        <div *ngIf="!loading" class="transactions-table">
            <div class="table-responsive">
                <table mat-table [dataSource]="dataSource" class="w-100">

                    <!-- Transaction Column -->
                    <ng-container matColumnDef="transaction">
                        <th mat-header-cell *matHeaderCellDef>Transaction</th>
                        <td mat-cell *matCellDef="let element">
                            <div class="d-flex align-items-center">
                                <div class="transaction-icon me-3"
                                    [style.background-color]="getCategoryColor(element.category)">
                                    <i class="material-symbols-outlined">{{ getCategoryIcon(element.category) }}</i>
                                </div>
                                <div class="transaction-info">
                                    <div class="transaction-title">{{ element.category | titlecase }}</div>
                                    <div class="transaction-subtitle">
                                        <span class="transaction-type"
                                            [style.color]="getTransactionTypeColor(element.type)">
                                            <i class="material-symbols-outlined">{{ getTransactionTypeIcon(element.type)
                                                }}</i>
                                            {{ element.type | titlecase }}
                                        </span>
                                        <span *ngIf="element.accountName" class="ms-2 text-muted">
                                            â€¢ {{ element.accountName }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Amount Column -->
                    <ng-container matColumnDef="amount">
                        <th mat-header-cell *matHeaderCellDef>Amount</th>
                        <td mat-cell *matCellDef="let element">
                            <div class="amount-display"
                                [ngClass]="element.type === 'credit' ? 'text-success' : 'text-danger'">
                                <span class="amount-symbol">{{ element.type === 'credit' ? '+' : '-' }}</span>
                                {{ formatCurrency(element.amount, element.currency) }}
                            </div>
                        </td>
                    </ng-container>

                    <!-- Date Column -->
                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef>Date</th>
                        <td mat-cell *matCellDef="let element">
                            <div class="date-display">
                                <div class="date-primary">{{ formatDate(element.date) }}</div>
                                <div class="date-secondary text-muted">
                                    {{ element.date | date:'short' }}
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Actions Column -->
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Actions</th>
                        <td mat-cell *matCellDef="let element">
                            <div class="d-flex align-items-center">
                                <button mat-icon-button [matMenuTriggerFor]="actionMenu"
                                    [matMenuTriggerData]="{transaction: element}">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #actionMenu="matMenu">
                                    <button mat-menu-item (click)="openEditTransactionDialog(element)">
                                        <mat-icon>edit</mat-icon>
                                        <span>Edit</span>
                                    </button>
                                    <button mat-menu-item (click)="deleteTransaction(element)" class="text-danger">
                                        <mat-icon>delete</mat-icon>
                                        <span>Delete</span>
                                    </button>
                                </mat-menu>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            </div>

            <!-- Pagination -->
            <mat-paginator [length]="totalTransactions" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 50]"
                (page)="onPageChange($event)" showFirstLastButtons>
            </mat-paginator>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && transactions.length === 0" class="text-center py-5">
            <div class="empty-state">
                <i class="material-symbols-outlined empty-icon">receipt_long</i>
                <h5 class="mt-3">No transactions found</h5>
                <p class="text-muted">Start by adding your first transaction</p>
                <button mat-raised-button color="primary" (click)="openAddTransactionDialog()">
                    <i class="material-symbols-outlined me-2">add</i>
                    Add Transaction
                </button>
            </div>
        </div>
    </mat-card-content>
</mat-card>