<mat-dialog-title class="dialog-title">
    <h4 class="mb-0">{{ isEditMode ? 'Edit Transaction' : 'Add New Transaction' }}</h4>
</mat-dialog-title>

<mat-dialog-content class="dialog-content">
    <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="transaction-form">
        <div class="form-grid">
            <!-- Transaction Type -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Transaction Type *</mat-label>
                    <mat-select formControlName="type">
                        <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
                            {{ type.label }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="getFieldError('type')">{{ getFieldError('type') }}</mat-error>
                </mat-form-field>
            </div>

            <!-- Category -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Category *</mat-label>
                    <mat-select formControlName="category">
                        <mat-option *ngFor="let category of categories" [value]="category.value">
                            {{ category.label }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="getFieldError('category')">{{ getFieldError('category') }}</mat-error>
                </mat-form-field>
            </div>

            <!-- Amount -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Amount *</mat-label>
                    <input matInput type="number" formControlName="amount" placeholder="0.00" step="0.01" min="0.01">
                    <mat-error *ngIf="getFieldError('amount')">{{ getFieldError('amount') }}</mat-error>
                </mat-form-field>
            </div>

            <!-- Currency -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Currency</mat-label>
                    <mat-select formControlName="currency">
                        <mat-option *ngFor="let currency of currencies" [value]="currency.value">
                            {{ currency.label }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Account Name -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Account Name</mat-label>
                    <input matInput formControlName="accountName" placeholder="e.g., Checking Account">
                </mat-form-field>
            </div>

            <!-- Date -->
            <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Date *</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="getFieldError('date')">{{ getFieldError('date') }}</mat-error>
                </mat-form-field>
            </div>

            <!-- Description -->
            <div class="form-field full-width">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Description</mat-label>
                    <textarea matInput formControlName="description" rows="3"
                        placeholder="Enter transaction description..."></textarea>
                </mat-form-field>
            </div>

            <!-- Tags -->
            <div class="form-field full-width">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Tags</mat-label>
                    <input matInput #tagInput placeholder="Add a tag and press Enter" (keyup.enter)="addTag(tagInput)">
                    <mat-hint>Press Enter to add tags</mat-hint>
                </mat-form-field>
                <div class="tags-container" *ngIf="transactionForm.get('tags')?.value?.length">
                    <mat-chip *ngFor="let tag of transactionForm.get('tags')?.value" (removed)="removeTag(tag)">
                        {{ tag }}
                        <mat-icon matChipRemove>cancel</mat-icon>
                    </mat-chip>
                </div>
            </div>

            <!-- Additional Options -->
            <div class="form-field full-width">
                <div class="additional-options">
                    <h6 class="section-title">Additional Options</h6>

                    <!-- Recurring Transaction -->
                    <div class="checkbox-field">
                        <mat-checkbox formControlName="isRecurring" class="recurring-checkbox">
                            <i class="material-symbols-outlined">repeat</i>
                            This is a recurring transaction
                        </mat-checkbox>
                    </div>

                    <!-- Source and External ID -->
                    <div class="options-row">
                        <div class="form-field">
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Source</mat-label>
                                <mat-select formControlName="source">
                                    <mat-option *ngFor="let source of sources" [value]="source.value">
                                        {{ source.label }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="form-field">
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>External ID</mat-label>
                                <input matInput formControlName="externalId" placeholder="External transaction ID">
                                <mat-hint>Optional external reference ID</mat-hint>
                            </mat-form-field>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</mat-dialog-content>

<mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="onCancel()" [disabled]="loading" class="cancel-btn">
        Cancel
    </button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="transactionForm.invalid || loading"
        class="submit-btn">
        <mat-spinner *ngIf="loading" diameter="20" class="me-2"></mat-spinner>
        <i *ngIf="!loading" class="material-symbols-outlined me-2">
            {{ isEditMode ? 'save' : 'add' }}
        </i>
        {{ isEditMode ? 'Update Transaction' : 'Add Transaction' }}
    </button>
</mat-dialog-actions>